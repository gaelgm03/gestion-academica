<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard - GestiÃ³n AcadÃ©mica</h1>
    
    <!-- Selector de perÃ­odo -->
    <div class="periodo-selector">
      <label>PerÃ­odo:</label>
      <select [(ngModel)]="selectedPeriodo" (change)="onPeriodoChange()">
        <option *ngFor="let p of periodos" [value]="p.id">{{ p.nombre }}</option>
      </select>
      
      <!-- Fechas personalizadas -->
      <div *ngIf="showCustomDates" class="custom-dates">
        <input type="date" [(ngModel)]="fechaInicio" placeholder="Desde">
        <input type="date" [(ngModel)]="fechaFin" placeholder="Hasta">
        <button (click)="applyCustomDates()" class="btn-apply">Aplicar</button>
      </div>
    </div>
  </div>

  <!-- Indicador de perÃ­odo activo y botones de exportaciÃ³n -->
  <div class="periodo-export-row">
    <div *ngIf="dashboardData?.periodo" class="periodo-info">
      ðŸ“… {{ dashboardData!.periodo!.descripcion }}
      <span *ngIf="dashboardData!.incidencias_periodo !== undefined">
        ({{ dashboardData!.incidencias_periodo }} incidencias en este perÃ­odo)
      </span>
    </div>
    
    <div class="export-buttons">
      <button (click)="exportarIncidencias()" class="btn-export" title="Exportar incidencias a CSV">
        ðŸ“¥ Incidencias
      </button>
      <button (click)="exportarDocentes()" class="btn-export" title="Exportar docentes a CSV">
        ðŸ“¥ Docentes
      </button>
      <button (click)="exportarEstadisticas()" class="btn-export" title="Exportar estadÃ­sticas a CSV">
        ðŸ“¥ EstadÃ­sticas
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <p>Cargando datos...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button (click)="loadDashboard()">Reintentar</button>
  </div>

  <div *ngIf="dashboardData && !loading" class="dashboard-content">
    <!-- EstadÃ­sticas principales -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Total Docentes</h3>
        <p class="stat-number">{{ dashboardData.dashboard.total_docentes }}</p>
      </div>
      <div class="stat-card">
        <h3>Docentes Activos</h3>
        <p class="stat-number">{{ dashboardData.dashboard.docentes_activos }}</p>
      </div>
      <div class="stat-card">
        <h3>Docentes SNI</h3>
        <p class="stat-number">{{ dashboardData.dashboard.docentes_sni }}</p>
      </div>
      <div class="stat-card">
        <h3>Total Incidencias</h3>
        <p class="stat-number">{{ dashboardData.dashboard.total_incidencias }}</p>
      </div>
      <div class="stat-card">
        <h3>Incidencias Abiertas</h3>
        <p class="stat-number">{{ dashboardData.dashboard.incidencias_abiertas }}</p>
      </div>
    </div>

    <!-- Incidencias por estado -->
    <div class="section">
      <h2>Incidencias por Estado</h2>
      <div class="chart-container">
        <div *ngFor="let item of dashboardData.incidencias_por_estado" class="chart-item">
          <span class="label">{{ item.status }}</span>
          <span class="value">{{ item.cantidad }}</span>
        </div>
      </div>
    </div>

    <!-- Incidencias por prioridad -->
    <div class="section">
      <h2>Incidencias por Prioridad</h2>
      <div class="chart-container">
        <div *ngFor="let item of dashboardData.incidencias_por_prioridad" class="chart-item">
          <span class="label">{{ item.prioridad }}</span>
          <span class="value">{{ item.cantidad }}</span>
        </div>
      </div>
    </div>

    <!-- Docentes por estatus -->
    <div class="section">
      <h2>Docentes por Estatus</h2>
      <div class="chart-container">
        <div *ngFor="let item of dashboardData.docentes_por_estatus" class="chart-item">
          <span class="label">{{ item.estatus }}</span>
          <span class="value">{{ item.cantidad }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
