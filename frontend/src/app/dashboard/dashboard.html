<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard - GestiÃ³n AcadÃ©mica</h1>
    
    <!-- Selector de perÃ­odo -->
    <div class="periodo-selector">
      <label>PerÃ­odo:</label>
      <select [(ngModel)]="selectedPeriodo" (change)="onPeriodoChange()">
        <option *ngFor="let p of periodos" [value]="p.id">{{ p.nombre }}</option>
      </select>
      
      <!-- Fechas personalizadas -->
      <div *ngIf="showCustomDates" class="custom-dates">
        <input type="date" [(ngModel)]="fechaInicio" placeholder="Desde">
        <input type="date" [(ngModel)]="fechaFin" placeholder="Hasta">
        <button (click)="applyCustomDates()" class="btn-apply">Aplicar</button>
      </div>
    </div>
  </div>

  <!-- Indicador de perÃ­odo activo y botones de exportaciÃ³n -->
  <div class="periodo-export-row">
    <div *ngIf="dashboardData?.periodo" class="periodo-info">
      ðŸ“… {{ dashboardData!.periodo!.descripcion }}
      <span *ngIf="dashboardData!.incidencias_periodo !== undefined">
        ({{ dashboardData!.incidencias_periodo }} incidencias en este perÃ­odo)
      </span>
    </div>
    
    <div class="export-buttons">
      <button (click)="exportarDashboardPdf()" class="btn-pdf" title="Exportar resumen a PDF">
        ðŸ“„ PDF
      </button>
      <div class="export-dropdown">
        <button class="btn-export dropdown-toggle">ðŸ“¥ Incidencias â–¾</button>
        <div class="dropdown-menu">
          <button (click)="exportarIncidencias('csv')">ðŸ“¥ CSV</button>
          <button (click)="exportarIncidencias('xlsx')">ðŸ“Š Excel</button>
        </div>
      </div>
      <div class="export-dropdown">
        <button class="btn-export dropdown-toggle">ðŸ“¥ Docentes â–¾</button>
        <div class="dropdown-menu">
          <button (click)="exportarDocentes('csv')">ðŸ“¥ CSV</button>
          <button (click)="exportarDocentes('xlsx')">ðŸ“Š Excel</button>
        </div>
      </div>
      <div class="export-dropdown">
        <button class="btn-export dropdown-toggle">ðŸ“¥ EstadÃ­sticas â–¾</button>
        <div class="dropdown-menu">
          <button (click)="exportarEstadisticas('csv')">ðŸ“¥ CSV</button>
          <button (click)="exportarEstadisticas('xlsx')">ðŸ“Š Excel</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="loading" class="loading">
    <p>Cargando datos...</p>
  </div>

  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button (click)="loadDashboard()">Reintentar</button>
  </div>

  <div *ngIf="dashboardData && !loading" class="dashboard-content">
    <!-- EstadÃ­sticas principales -->
    <div class="stats-grid">
      <div class="stat-card">
        <h3>Total Docentes</h3>
        <p class="stat-number">{{ dashboardData.dashboard.total_docentes }}</p>
      </div>
      <div class="stat-card">
        <h3>Docentes Activos</h3>
        <p class="stat-number">{{ dashboardData.dashboard.docentes_activos }}</p>
      </div>
      <div class="stat-card">
        <h3>Docentes SNI</h3>
        <p class="stat-number">{{ dashboardData.dashboard.docentes_sni }}</p>
      </div>
      <div class="stat-card">
        <h3>Total Incidencias</h3>
        <p class="stat-number">{{ dashboardData.dashboard.total_incidencias }}</p>
      </div>
      <div class="stat-card">
        <h3>Incidencias Abiertas</h3>
        <p class="stat-number">{{ dashboardData.dashboard.incidencias_abiertas }}</p>
      </div>
    </div>

    <!-- GrÃ¡ficas en grid -->
    <div class="charts-grid">
      <!-- Incidencias por estado (Doughnut) -->
      <div class="chart-card">
        <h3>ðŸ“Š Incidencias por Estado</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [type]="estadoChartType"
            [data]="estadoChartData"
            [options]="estadoChartOptions">
          </canvas>
        </div>
        <div class="chart-legend">
          <div *ngFor="let item of dashboardData.incidencias_por_estado" class="legend-item">
            <span class="legend-label">{{ item.status | titlecase }}</span>
            <span class="legend-value">{{ item.cantidad }}</span>
          </div>
        </div>
      </div>

      <!-- Incidencias por prioridad (Bar) -->
      <div class="chart-card">
        <h3>âš¡ Incidencias por Prioridad</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [type]="prioridadChartType"
            [data]="prioridadChartData"
            [options]="prioridadChartOptions">
          </canvas>
        </div>
        <div class="chart-legend">
          <div *ngFor="let item of dashboardData.incidencias_por_prioridad" class="legend-item">
            <span class="legend-label">{{ item.prioridad }}</span>
            <span class="legend-value">{{ item.cantidad }}</span>
          </div>
        </div>
      </div>

      <!-- Docentes por estatus (Pie) -->
      <div class="chart-card">
        <h3>ðŸ‘¥ Docentes por Estatus</h3>
        <div class="chart-wrapper">
          <canvas baseChart
            [type]="docentesChartType"
            [data]="docentesChartData"
            [options]="docentesChartOptions">
          </canvas>
        </div>
        <div class="chart-legend">
          <div *ngFor="let item of dashboardData.docentes_por_estatus" class="legend-item">
            <span class="legend-label">{{ item.estatus | titlecase }}</span>
            <span class="legend-value">{{ item.cantidad }}</span>
          </div>
        </div>
      </div>

      <!-- Tendencia diaria (Line) - ocupa 2 columnas -->
      <div class="chart-card chart-wide" *ngIf="dashboardData.tendencia_diaria && dashboardData.tendencia_diaria.length > 0">
        <h3>ðŸ“ˆ Tendencia de Incidencias</h3>
        <div class="chart-wrapper chart-tall">
          <canvas baseChart
            [type]="tendenciaChartType"
            [data]="tendenciaChartData"
            [options]="tendenciaChartOptions">
          </canvas>
        </div>
      </div>
    </div>
  </div>
</div>
